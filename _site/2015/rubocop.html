<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <title>why I think RuboCop is so cool, and how to contribute to it - hardscrabble</title>
  <meta content='Max Jacobson' name='author'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href='/feed.xml' rel='alternate' title='Posts feed' type='application/atom+xml'>
  <link href='/img/favicon.ico' rel='icon' type='image/x-icon'>
  <link rel="stylesheet" href="/css/lib/pinboard.css">
<link rel="stylesheet" href="/css/lib/normalize.css">
<link rel="stylesheet" href="/css/lib/solarized.css">
<link rel="stylesheet" href="/css/style.css">



  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', "UA-4982721-15", 'auto');
  ga('send', 'pageview');

</script>


</head>
<body>

<header>
  <h1><a href="/">hardscrabble</a></h1>
  <nav>
    <a href="/">home</a>
    | <a href="/about/">about</a>
    | <a href="/metaphorloop/">metaphor loop</a>
    | <a href="/search/">search</a>
    | <a href="/links/">links</a>
  </nav>
</header>

<div class="post">

  <div class="metadata">
    <div class="title">
      <h2>
        why I think RuboCop is so cool, and how to contribute to it
      </h2>
    </div>
    <div class="byline">
      by <a href='/about'>Max Jacobson</a>
    </div>
    <div class="date">
      09 Aug 2015
    </div>
  </div>

  <div class="body">
    <h2 id="rubocop-as-compiler">RuboCop as compiler</h2>

<p>Ruby is not a compiled language.</p>

<p>You can write code which has obvious flaws and Ruby will run it and then it will
fail at runtime. For example:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="nb">puts</span> <span class="s2">"hello world"</span>
<span class="nb">puts</span> <span class="n">hello</span> <span class="n">world</span>
</code></pre>
</div>

<p>That produces this output:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ ruby lol.rb
hello world
/Users/max/Desktop/lol.rb:2:in `&lt;main&gt;': undefined local variable or method `world' for main:Object (NameError)
</code></pre>
</div>

<p>Some other languages wouldn’t even run that program. For example, the same code
in Go:</p>

<div class="language-go highlighter-rouge"><pre class="highlight"><code><span class="k">package</span><span class="x"> </span><span class="n">main</span><span class="x">

</span><span class="k">import</span><span class="x"> </span><span class="s">"fmt"</span><span class="x">

</span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"hello world"</span><span class="p">)</span><span class="x">
	</span><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">hello_world</span><span class="p">)</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre>
</div>

<p>Running that produces this output:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ go run lol.go
# command-line-arguments
./lol.go:7: undefined: hello_world
</code></pre>
</div>

<p>But Ruby can’t run anything. Look at this bullshit:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="nb">puts</span> <span class="s2">"hello world"</span>

<span class="k">def</span> <span class="nf">lol</span>
  <span class="nb">puts</span> <span class="s2">"lol world"</span>

<span class="n">lol</span>
</code></pre>
</div>

<p>Running that produces this output:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ ruby lol.rb
/Users/max/Desktop/lol.rb:7: syntax error, unexpected end-of-input, expecting keyword_end
</code></pre>
</div>

<p>Notice: it doesn’t even output “hello world”; it just straight-up fails to run.
You might say it doesn’t compile.</p>

<p>Ruby actually has a command line flag for checking the syntactic-correctness of
a program:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ ruby -c lol.rb
/Users/max/Desktop/lol.rb:7: syntax error, unexpected end-of-input, expecting keyword_end
$ ruby -c ok_program.rb
Syntax OK
</code></pre>
</div>

<p>This is useful, but only to a point. It means your programs will usually run,
but you’ll have more errors at runtime than you would writing in a language like
Go (for example).</p>

<p>I barely know Go, but in the small exposure I’ve had, I’ve really enjoyed how
nit-picky the compiler is. For example, this program:</p>

<div class="language-go highlighter-rouge"><pre class="highlight"><code><span class="k">package</span><span class="x"> </span><span class="n">main</span><span class="x">

</span><span class="k">import</span><span class="x"> </span><span class="s">"fmt"</span><span class="x">

</span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="n">msg</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="s">"Hello world"</span><span class="x">
	</span><span class="n">other_msg</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="s">"lol world"</span><span class="x">
	</span><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre>
</div>

<p>Running it produces this output:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># command-line-arguments
./lol.go:7: other_msg declared and not used
</code></pre>
</div>

<p>What! I can’t run my program because I declared a variable but then didn’t use
it?? Who cares?? Go cares! And I kind of do too, now. Why have it if you don’t
need it? Go kind of forces you to write really intention-revealing code and to
clean up anything which might obscure your intentions. That’s great.</p>

<p>Ruby doesn’t care as much about that.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">msg</span> <span class="o">=</span> <span class="s1">'hello world'</span>
<span class="n">other_msg</span> <span class="o">=</span> <span class="s1">'lol world'</span>
<span class="nb">puts</span> <span class="n">msg</span>
</code></pre>
</div>

<p>That’s fine:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ ruby -c lol.rb
Syntax OK
$ ruby lol.rb
hello world
</code></pre>
</div>

<p>So now your code has this random unused variable. It’s not <em>really</em> hurting
anyone or anything. In theory it has a performance impact, as it’s allocating
an object you don’t really need it to, and if this code is run a ton that could
matter. But more importantly, I think, it’s just clutter. When people come
across this code in the future they won’t know why it’s there, but they might
assume it’s there for a reason, and they’ll mentally mark this area of the code
base as kind of strange and unknowable.</p>

<p><a href="https://github.com/bbatsov/rubocop">RuboCop</a> is a gem which can help bring Ruby
closer toward Go levels of nit-pickiness, and I’m a huge fan of it. I recommend
including it in your Ruby projects and running it alongside your tests to
enforce adherence to its rules (“cops” in its parlance).</p>

<p>Running that same ruby program through RuboCop produces this output (note: you
have to <code class="highlighter-rouge">gem install rubocop</code> first):</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ rubocop lol.rb
Inspecting 1 file
W

Offenses:

lol.rb:2:1: W: Useless assignment to variable - other.
other = 'lol world'
^^^^^

1 file inspected, 1 offense detected
</code></pre>
</div>

<p>Awesome! Now we know our code contains some offense and might be confusing our
collaborators, and we know exactly where to make the change.</p>

<hr />

<h2 id="rubocop-as-code-style-nit-picker">RuboCop as code style nit picker</h2>

<p>RuboCop is also very opinionated about code style. For example, it will complain
if you aren’t consistent about using single or double quotes, or if you aren’t
consistent about using two spaces for indentation, or if you leave spaces at the
end of your lines.</p>

<p>I recommend configuring it to your taste and to not feel guilty about disabling
cops which you don’t find valuable. As a tool, it adheres to the “strong
opinions, weakly held” mantra: it’s very easy to bribe this cop into changing
its opinions by adding a simple yml file to the root of your project.</p>

<p>The Go compiler isn’t picky about things like code style, but Go ships with a
secondary, optional tool called <a href="https://golang.org/cmd/gofmt/">gofmt</a> which is extraordinarily opinionated:
it straight-up rewrites your code to follow Go style conventions.</p>

<p>Similarly, many RuboCop cops are auto-correctable. Consider this program a
“before picture”:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dog</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="ss">:name</span><span class="p">)</span>
    
    <span class="vi">@name</span><span class="o">=</span><span class="nb">name</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">milo</span> <span class="o">=</span> <span class="no">Dog</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"Milo"</span><span class="p">)</span>
<span class="nb">p</span> <span class="n">milo</span>


</code></pre>
</div>

<p>Kind of ugly looking, but it’s syntactically valid:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ ruby -v
ruby 2.0.0p451 (2014-02-24 revision 45167) [x86_64-darwin14.3.0]
$ ruby -c lol.rb
Syntax OK
$ ruby lol.rb
#&lt;Dog:0x007fbe64207a40 @name="Milo"&gt;
</code></pre>
</div>

<p>So let’s try autocorrecting it:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ rubocop lol.rb --auto-correct
Inspecting 1 file
W

Offenses:

lol.rb:1:1: C: Missing top-level class documentation comment.
class Dog
^^^^^
lol.rb:2:1: C: [Corrected] Extra empty line detected at class body beginning.
lol.rb:2:23: W: Circular argument reference - name.
  def initialize(name:name)
                      ^^^^
lol.rb:3:1: C: [Corrected] Extra empty line detected at method body beginning.
lol.rb:3:1: C: [Corrected] Trailing whitespace detected.
lol.rb:4:1: C: [Corrected] Trailing whitespace detected.
lol.rb:4:5: W: end at 4, 4 is not aligned with def at 2, 2.
    end
    ^^^
lol.rb:4:10: C: [Corrected] Surrounding space missing for operator =.
    @name=name
         ^
lol.rb:5:10: C: [Corrected] Surrounding space missing for operator =.
    @name=name
         ^
lol.rb:8:22: C: [Corrected] Prefer single-quoted strings when you don't need string interpolation or special symbols.
milo = Dog.new(name: "Milo")
                     ^^^^^^
lol.rb:9:22: C: [Corrected] Prefer single-quoted strings when you don't need string interpolation or special symbols.
milo = Dog.new(name: "Milo")
                     ^^^^^^
lol.rb:10:1: C: [Corrected] 2 trailing blank lines detected.
lol.rb:11:1: C: [Corrected] 2 trailing blank lines detected.

1 file inspected, 13 offenses detected, 10 offenses corrected
</code></pre>
</div>

<p>Afterwards, the program looks like:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dog</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="ss">:name</span><span class="p">)</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">milo</span> <span class="o">=</span> <span class="no">Dog</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s1">'Milo'</span><span class="p">)</span>
<span class="nb">p</span> <span class="n">milo</span>
</code></pre>
</div>

<p>It’s not perfect. I’m surprised it didn’t autocorrect the indentation on the
first <code class="highlighter-rouge">end</code>. But it’s neat that it did as much as it did.</p>

<p><strong>EDIT</strong>: I opened <a href="https://github.com/bbatsov/rubocop/issues/2125">an issue</a> about this surprise and it turns out they don’t
want to autocorrect that unless you really opt in.</p>

<p>In the past, I’ve written about how <a href="/2015/ruby-keyword-arguments-arent-obvious/">Ruby Keyword Arguments aren’t Obvious</a>,
and mentioned “circular argument references” as a mistake I had to learn not to
make. In an attempt to give back to others like me, I submitted <a href="https://github.com/bbatsov/rubocop/pull/2070">a pull
request</a> which adds a cop to RuboCop that checks for the presence of those
circular argument references and warns you about them. This is particularly
useful on Ruby 2.0.0 and Ruby 2.1, which don’t emit warnings about their
presence as Ruby 2.2 does.</p>

<hr />

<h2 id="contributing-to-rubocop">contributing to RuboCop</h2>

<p>Contributing to RuboCop is somewhat intimidating because, as you might imagine,
its code base has very high standards. It also seems like it ought to be very
complicated, because the project needs to be able to statically analyze code
in order to complain about it.</p>

<p>Fortunately, the maintainers are very clear and quick in their feedback, and
happy to merge things which seem useful. And the code base has many examples of
how to write a cop. A cop is a class which inherits from <code class="highlighter-rouge">RuboCop::Cop::Cop</code>.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'rubocop'</span>
<span class="nb">require</span> <span class="s1">'active_support/all'</span>
<span class="no">RuboCop</span><span class="o">::</span><span class="no">Cop</span><span class="o">::</span><span class="no">Cop</span><span class="p">.</span><span class="nf">subclasses</span><span class="p">.</span><span class="nf">count</span> <span class="c1">#=&gt; 226</span>
<span class="c1"># (required active support for the subclasses method, which I love)</span>
</code></pre>
</div>

<p>Once you subclass <code class="highlighter-rouge">Cop</code>, your class will be on duty and RuboCop will ask it if
it’s offended by the code it’s analyzing. You just need to tell it which types
of code you care about. RuboCop thinks of Ruby code as a tree of nested nodes,
each having a type. For example, when you assign a local variable, RuboCop sees
that as a node whose type is <code class="highlighter-rouge">:lvasgn</code>. Let’s say you wanted to write a cop
where local variables aren’t allowed to be named “harold”. You would write that
like this:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># encoding: utf-8</span>

<span class="k">module</span> <span class="nn">RuboCop</span>
  <span class="k">module</span> <span class="nn">Cop</span>
    <span class="k">module</span> <span class="nn">Lint</span>
      <span class="k">class</span> <span class="nc">Harold</span> <span class="o">&lt;</span> <span class="no">Cop</span>
        <span class="k">def</span> <span class="nf">on_lvasgn</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
          <span class="n">local_variable_name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="o">*</span><span class="n">node</span>
          <span class="k">return</span> <span class="k">unless</span> <span class="n">local_variable_name</span> <span class="o">==</span> <span class="ss">:harold</span>
          <span class="n">add_offense</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="ss">:expression</span><span class="p">,</span> <span class="s1">'Do not name local variables harold'</span><span class="p">)</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>The trickiest bit is learning how RuboCop “sees” code as nodes and learning what
the different parts are called. That comes from looking through the existing
examples and experimenting. It’s fun, I recommend it. I added <a href="https://github.com/bbatsov/rubocop/pull/2078">one other cop</a>
on a bored evening, about discouraging option hashes.</p>

<hr />

<h2 id="rubocop-as-teacher">RuboCop as teacher</h2>

<p>This summer, I coordinated a group of 5 developer interns at work. I helped pick
them out, so I knew they were all very bright but not super experienced with
Ruby. We asked them to study a bit and follow the <a href="https://www.railstutorial.org/book">Rails Tutorial Book</a>
before starting to help get them on the same page, but we didn’t expect them to
know Ruby conventions or best practices.</p>

<p>From the beginning, their project had RuboCop linting their code, with zero
configuration. I warned them, “you’re going to hate this”. On their last week,
I asked them if it was helpful, and they all said yes, but that it was often
very annoying. Some of them liked it more than others. One even made <a href="https://github.com/bbatsov/rubocop/pull/2085">a
contribution</a> to RuboCop fixing an issue in the cop I added. They produced a
very interesting code base. Superficially, it’s immaculate. They picked up a few
tricks from RuboCop suggestions. More than one cited <a href="https://github.com/bbatsov/rubocop/blob/master/lib/rubocop/cop/style/guard_clause.rb">guard clauses</a> as a
thing they wouldn’t know about otherwise.</p>

<p>The class length maximum (100 lines) and the method length maximum (10 lines)
were both unhelpful. They’re meant to guide you toward following the single
responsibility principle, but if it’s not something you’ve internalized, it just
sort of makes you stuck and frustrated.</p>

<p>I came to think of RuboCop (and, later, <a href="http://www.coffeelint.org/">coffeelint</a> and <a href="https://github.com/brigade/scss-lint">scss-lint</a>) as
an automated layer of mentorship filtering out some potential questions that
didn’t need to reach the human layer, so that layer could be reserved for more
interesting problems and discussions.</p>

<hr />

<h2 id="rubocop-as-totalitarian-police-state">RuboCop as totalitarian police state?</h2>

<p>I do think of programming as a creative outlet, but don’t worry about linters
inhibiting your creativity; think of it like a poetic form with strict rules,
like the sonnet. There’s something very satisfying about consistency, right?</p>

  </div>

  <div class="post-footer">
    <p>
      Feel free to get in touch via <a href='http://twitter.com/maxjacobson'>@maxjacobson</a> or <a href='mailto:max@hardscrabble.net'>max@hardscrabble.net</a>
    </p>
  </div>

</div>


<footer>
  <div>
    Powered by <a href="http://jekyllrb.com/">Jekyll</a>
    and hosted on <a href="https://pages.github.com/">GitHub Pages</a>.
    The source is <a href="https://github.com/hardscrabble/hardscrabble.github.io">available to browse, for nerds</a>.
    The feed can be found at <a href="/feed.xml">feed.xml</a>
  </div>
</footer>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<script src='/js/vendor/lunr.min.js'></script>
<script src='/js/app.js'></script>


<script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100815498); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100815498ns.gif" /></p></noscript>
</body>
</html>

