<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="UTF-8">
  <title>git fresh branch - hardscrabble</title>
  <meta content="Max Jacobson" name="author">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/feed.xml" rel="alternate" title="Posts feed" type="application/atom+xml">
  <link href="/img/favicon.ico" rel="icon" type="image/x-icon">
  <link rel="stylesheet" href="/css/lib/pinboard.css">
<link rel="stylesheet" href="/css/lib/normalize.css">
<link rel="stylesheet" href="/css/lib/solarized.css">
<link rel="stylesheet" href="/css/style.css">



  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', "UA-4982721-15", 'auto');
  ga('send', 'pageview');

</script>


</head>
<body>

<header>
  <h1><a href="/">hardscrabble</a></h1>
  <nav>
    <a href="/">home</a>
    | <a href="/about/">about</a>
    | <a href="/metaphorloop/">metaphor loop</a>
    | <a href="/search/">search</a>
    | <a href="/links/">links</a>
  </nav>
</header>

<div class="post">

  <div class="metadata">
    <div class="title">
      <h2>
        git fresh branch
      </h2>
    </div>
    <div class="byline">
      by <a href="/about">Max Jacobson</a>
    </div>
    <div class="date">
      28 Nov 2014
    </div>
  </div>

  <div class="body">
    <p>Tonight while clicking around the web I discovered
<a href="https://github.com/tj/git-extras">tj/git-extras</a>, a set of useful git tools
maintained by TJ Holowaychuk<sup id="fnref:tj"><a href="#fn:tj" class="footnote">1</a></sup>. Once installed, your <code class="highlighter-rouge">git</code> command is
overloaded with a bunch of new, useful commands.</p>

<p>It’s easy to install, but it does add quite a lot of stuff, and I was worried
for a moment that it would clobber some existing aliases of my own. One, <a href="https://github.com/tj/git-extras/blob/master/bin/git-squash">git squash</a>,
comes dangerously close to my beloved <a href="https://github.com/maxjacobson/dotfiles/blob/f40c96fd883912f37f1451a2a41cb8c32c2c963f/.gitconfig#L16">git squasher</a>, but doesn’t
actually conflict.</p>

<p>If you are worried about it, you can safely pick and choose which extras you
want by saving <a href="https://github.com/tj/git-extras/tree/master/bin">individual scripts</a> and just making sure they’re all on your
PATH and executable.</p>

<p>The readme explains their purposes nicely, but I want to emphasize one in
particular: <code class="highlighter-rouge">git fresh-branch &lt;branch name&gt;</code> which does stuff I didn’t know was
possible.</p>

<p>Let’s say you’re maintaining an open source library that has existed long enough
to accumulate many commits and files. Let’s say you want to create <a href="https://pages.github.com/">a github
page</a> for that library to explain what it’s all about
and how to use it. The way github pages works, you should create a new branch in
the same repo with the branch name <code class="highlighter-rouge">gh-pages</code>, and on that branch you keep a set
of assets that will become a static website. But when you create a new branch,
it will have all of the code from your open source library, and an entire
history of commmits. I can imagine doing something like this:</p>

<div class="highlighter-rouge">
<pre class="highlight"><code># create a new branch
git checkout -b gh-pages
# delete all of the existing files
git ls-files | xargs rm
# stage those deletes
git add -A
# commit the change
git commit -m 'BURN IT DOWN'

# create the first version of the site
echo 'hello! use my gem!' &gt; index.html
git add index.html
git commit -m 'gh-pages init'
git push origin gh-pages
</code></pre>
</div>

<p>And then I’d wait for GitHub to do its magic and expect to see my great page
online in a few minutes.</p>

<p>It’s kind of awkward having a ‘BURN IT DOWN’ commit, but I didn’t know there was
an alternative. With git extras, that could look more like this:</p>

<div class="highlighter-rouge">
<pre class="highlight"><code># create a new branch WITH NO HISTORY AT ALL
# NOT ONE COMMIT
git fresh-branch gh-pages

# create the first version of the site
echo 'hello! use my gem!' &gt; index.html
git add index.html
git commit -m 'gh-pages init'
git push origin gh-pages
</code></pre>
</div>

<p>How the heck does it work? We can look at the fresh-branch script <a href="https://github.com/tj/git-extras/blob/master/bin/git-fresh-branch">online</a>,
but I’ll include the latest version here for reference:</p>

<div class="language-bash highlighter-rouge">
<pre class="highlight"><code><span class="c">#!/bin/sh</span>

<span class="nv">branch</span><span class="o">=</span><span class="nv">$1</span>

<span class="nb">test</span> -z <span class="nv">$branch</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"branch required."</span> 1&gt;&amp;2 <span class="o">&amp;&amp;</span> <span class="nb">exit </span>1

git symbolic-ref HEAD refs/heads/<span class="nv">$branch</span>
rm .git/index
git clean -fdx
</code></pre>
</div>

<p>I guess a lot of the work is being done by <a href="http://git-scm.com/docs/git-symbolic-ref">symbolic-ref</a>.</p>

<p>While researching this post, I noticed that git-extras also offers a
<a href="https://github.com/tj/git-extras/blob/master/bin/git-gh-pages">gh-pages</a> script
that is even more tailored to the use case from my example. Of course! <img class="emoji" title=":leaves:" alt=":leaves:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f343.png" height="20" width="20" align="absmiddle"></p>

<hr>

<p><strong>edit</strong>: I probably should have slept on this post and actually explored more
how it’s working under the hood. But I did not.</p>

<div class="footnotes">
  <ol>
    <li id="fn:tj">
      <p>Formerly ‘visionmedia’ on GitHub <a href="#fnref:tj" class="reversefootnote">↩</a></p>
    </li>
  </ol>
</div>

  </div>

  <div class="post-footer">
    <p>
      Feel free to get in touch via <a href="http://twitter.com/maxjacobson">@maxjacobson</a> or <a href="mailto:max@hardscrabble.net">max@hardscrabble.net</a>
    </p>
  </div>

</div>


<footer>
  <div>
    Powered by <a href="http://jekyllrb.com/">Jekyll</a>
    and hosted on <a href="https://pages.github.com/">GitHub Pages</a>.
    The source is <a href="https://github.com/hardscrabble/hardscrabble.github.io">available to browse, for nerds</a>.
    The feed can be found at <a href="/feed.xml">feed.xml</a>
  </div>
</footer>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<script src="/js/vendor/lunr.min.js"></script>
<script src="/js/app.js"></script>


<script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100815498); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100815498ns.gif"></p></noscript>
</body>
</html>
