<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <title>integrating vim with the mac clipboard - hardscrabble</title>
  <meta content='Max Jacobson' name='author'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href='/feed.xml' rel='alternate' title='Posts feed' type='application/atom+xml'>
  <link href='/img/favicon.ico' rel='icon' type='image/x-icon'>
  <link rel="stylesheet" href="/css/lib/pinboard.css">
<link rel="stylesheet" href="/css/lib/normalize.css">
<link rel="stylesheet" href="/css/lib/solarized.css">
<link rel="stylesheet" href="/css/style.css">



  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', "UA-4982721-15", 'auto');
  ga('send', 'pageview');

</script>


</head>
<body>

<header>
  <h1><a href="/">hardscrabble</a></h1>
  <nav>
    <a href="/">home</a>
    | <a href="/about/">about</a>
    | <a href="/metaphorloop/">metaphor loop</a>
    | <a href="/search/">search</a>
    | <a href="/links/">links</a>
  </nav>
</header>

<div class="post">

  <div class="metadata">
    <div class="title">
      <h2>
        integrating vim with the mac clipboard
      </h2>
    </div>
    <div class="byline">
      by <a href='/about'>Max Jacobson</a>
    </div>
    <div class="date">
      30 Jul 2016
    </div>
  </div>

  <div class="body">
    <p>Using terminal text editors has a lot of advantages, but for a while the biggest disadvantage I’ve felt as a vim user is that it’s kind of hard to interact with the system clipboard.
I’m aware that there’s a concept called “registers” which are something like multiple clipboards that you can copy and paste from, and one of them is the system clipboard, and the others are all virtual, or something like this, but I haven’t taken the time to really learn how those work yet.</p>

<p>If I want to copy a helpful code snippet from Stack Overflow into vim and I copy it to the mac clipboard, and then press “command + v” to paste it into vim, the indentation gets totally screwed up.
This is becuse vim is trying to help.
It doesn’t know that I just pasted, it thinks that I was suddenly just typing <em>super super fast</em> and each newline character I “typed” caused it to helpfully auto-indent the appropriate amount.
When I actually am typing, this is helpful.
But when I’m pasting, it’s kind of annoying.</p>

<p><img src="/img/2016-07-30-vim-bad-paste.png" alt="Pasting into vim doesn't work well" /></p>

<p>(You can see in this example that not only is the indentation screwed up, but also there is an extra <code class="highlighter-rouge">end</code> which <a href="https://github.com/tpope/vim-endwise">vim-endwise</a> helpfully tried to auto-insert)</p>

<p>The workaround I’ve used for a while is to always run <code class="highlighter-rouge">:set paste</code> before I paste, and then <code class="highlighter-rouge">:set nopaste</code> afterward.
This mode doesn’t auto-indent.
It also breaks a number of my other vim configurations, such as <code class="highlighter-rouge">jk</code> being an alias for the escape key.</p>

<p>Pretty annoying.</p>

<p>Copying text out of vim is even more difficult.
I can use my mouse to highlight the text I want to copy and then press “command + c” to copy it, but this is pretty awful, too, because it’s very easy to accidentally copy things like line numbers (which are just text in the terminal, and your mouse doesn’t know to avoid it) or to even copy text from multiple files which you happen to have open side by side in split buffers, such that the code is totally broken when you paste it out again.</p>

<p><img src="/img/2016-07-30-vim-split-buffer.png" alt="Copying from vim split buffer doesn't work well" /></p>

<p>My workaround for this is even worse! I generally close my splits, turn off line numbers (<code class="highlighter-rouge">:set nonumber</code>) and sometimes make my font smaller so I can fit the whole lines on my screen and select the text and copy it.
When I do this, I generally pick up a bunch of trailing whitespace that wasn’t there in the source code.
It totally stinks.</p>

<p>Sometimes I will just open the file in <a href="https://atom.io">Atom</a> so I can copy text in a sane way.</p>

<p>Other times I will run <code class="highlighter-rouge">:! cat % | pbcopy</code> to “shell out” to a bash command and copy the entire contents of the file to the clipboard.<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup></p>

<p>OK.
So obviously that sucks, right?
That’s just some context for how I’ve been doing things.
I meant to look into a better technique and never got to it.</p>

<p>The other day at work I saw my coworker Will very seamlessly copy some text out of vim and paste it into Slack.</p>

<p>Scandalized, I asked him how he had done that.
He told me he’s using <a href="https://neovim.io">neovim</a> and it’s probably something neovim does.</p>

<p>I made a note to look into it.
I’m open to the idea of using neovim instead of regular vim – I think it’s cool that you can <a href="https://neovim.io/doc/user/nvim_terminal_emulator.html">run a terminal inside vim</a>, which makes me wonder if I even need tmux…</p>

<p>One of the first things I found in my research was <a href="https://github.com/neovim/neovim/issues/583">a neovim issue from April 2014</a> about how some vim configuration was working in vim but not neovim</p>

<blockquote>
  <p>… the follwing works perfectly fine with mainline vim, “y” and “p” work with X clipboard:</p>

  <div class="highlighter-rouge"><pre class="highlight"><code>set clipboard=unnamedplus
</code></pre>
  </div>

  <p>but not for neovim.</p>

  <p>I’ve tried setting it to:</p>

  <div class="highlighter-rouge"><pre class="highlight"><code>set clipboard=unnamed
</code></pre>
  </div>

  <p>still works in vim, but not neovim.</p>
</blockquote>

<p>Hm. Wait. Does this mean vim already supports clipboard integration this whole time and no one told me!?</p>

<p>Indeed, yes, and this is why I’m writing this blog post to tell you.
I feel like there’s a good chance you already knew.</p>

<p>So yep, I <a href="https://github.com/maxjacobson/dotfiles/commit/0d4bd62bef49c4607e6e4349f16ae24a3be5949b">added</a> that second config option to my .vimrc and now it works great:</p>

<ul>
  <li>I can yank text from vim and then “command + v” it into other apps.</li>
  <li>I can copy text from Stack Overflow and then “p” it into vim – no weird indentation behavior or anything</li>
</ul>

<p>I may yet switch to neovim<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup> or learn about registers, but for now I don’t yet need to, and for that I celebrate.</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>The <code class="highlighter-rouge">!</code> means to run a bash command; the <code class="highlighter-rouge">%</code> will expand to refer to the file name; <code class="highlighter-rouge">pbcopy</code> is a mac thing for piping data to your clipboard. <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>Note that neovim did fix that issue and <a href="https://neovim.io/doc/user/provider.html#provider-clipboard">it does work now</a>. <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

  </div>

  <div class="post-footer">
    <p>
      Feel free to get in touch via <a href='http://twitter.com/maxjacobson'>@maxjacobson</a> or <a href='mailto:max@hardscrabble.net'>max@hardscrabble.net</a>
    </p>
  </div>

</div>


<footer>
  <div>
    Powered by <a href="http://jekyllrb.com/">Jekyll</a>
    and hosted on <a href="https://pages.github.com/">GitHub Pages</a>.
    The source is <a href="https://github.com/hardscrabble/hardscrabble.github.io">available to browse, for nerds</a>.
    The feed can be found at <a href="/feed.xml">feed.xml</a>
  </div>
</footer>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<script src='/js/vendor/lunr.min.js'></script>
<script src='/js/app.js'></script>


<script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100815498); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100815498ns.gif" /></p></noscript>
</body>
</html>

