<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <title>required keyword arguments in Ruby 2.0.0 - hardscrabble</title>
  <meta content='Max Jacobson' name='author'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href='/feed.xml' rel='alternate' title='Posts feed' type='application/atom+xml'>
  <link href='/img/favicon.ico' rel='icon' type='image/x-icon'>
  <link rel="stylesheet" href="/css/lib/pinboard.css">
<link rel="stylesheet" href="/css/lib/normalize.css">
<link rel="stylesheet" href="/css/lib/solarized.css">
<link rel="stylesheet" href="/css/style.css">



  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', "UA-4982721-15", 'auto');
  ga('send', 'pageview');

</script>


</head>
<body>

<header>
  <h1><a href="/">hardscrabble</a></h1>
  <nav>
    <a href="/">home</a>
    | <a href="/about/">about</a>
    | <a href="/metaphorloop/">metaphor loop</a>
    | <a href="/search/">search</a>
    | <a href="/links/">links</a>
  </nav>
</header>

<div class="post">

  <div class="metadata">
    <div class="title">
      <h2>
        required keyword arguments in Ruby 2.0.0
      </h2>
    </div>
    <div class="byline">
      by <a href='/about'>Max Jacobson</a>
    </div>
    <div class="date">
      29 Jun 2015
    </div>
  </div>

  <div class="body">
    <p>TLDR: I made a gem, <a href="https://github.com/maxjacobson/required_arg">required_arg</a>
which offers a workflow for requiring keyword arguments in Ruby 2.0.0, which
doesn’t support them on the language level.</p>

<p>In March, we <a href="/2015/ruby-keyword-arguments-arent-obvious/">looked at</a> Ruby keyword arguments, and noted a curious tension.</p>

<p>Sometimes you want to use keyword arguments, and you don’t want to come up with
a default value for that keyword. You kind of want to require the keyword. You
can in Ruby 2.1+, but Ruby 2.0.0 is in the awkward position of <em>having</em> keyword
arguments but not being able to require them.</p>

<p>Here’s what you can do in Ruby 2.1:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dog</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">:)</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Dog</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"Milo"</span><span class="p">)</span> <span class="c1">#=&gt; #&lt;Dog:0x007fc404df9f10 @name="Milo"&gt;</span>
<span class="no">Dog</span><span class="p">.</span><span class="nf">new</span> <span class="c1">#=&gt; an exception is raised: ArgumentError: missing keyword: name</span>
</code></pre>
</div>

<p>That’s great! You don’t need to write any additional code, and Ruby will enforce
that your method is called with the keyword arguments you require. This gives
you flexibility to design interfaces which take advantage of the flexibility and
clarity of keyword arguments, but still establish some expectations for how the
method will be called.</p>

<p>Here’s what happens when you do the same in Ruby 2.0.0:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dog</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">:)</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="c1"># dog.rb:2: syntax error, unexpected ')'</span>
<span class="c1"># dog.rb:5: syntax error, unexpected keyword_end, expecting end-of-input</span>
</code></pre>
</div>

<p>Syntax error!</p>

<p>Here’s what I suggest doing now:</p>

<ol>
  <li>Upgrade to a newer version of Ruby</li>
  <li>If you can’t, try this:</li>
</ol>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># gem install required_arg</span>
<span class="nb">require</span> <span class="s2">"required_arg"</span>

<span class="k">class</span> <span class="nc">Dog</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="ss">name: </span><span class="no">RequiredArg</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:name</span><span class="p">))</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="no">Dog</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"Milo"</span><span class="p">)</span> <span class="c1">#=&gt; #&lt;Dog:0x007fc404df9f10 @name="Milo"&gt;</span>
<span class="no">Dog</span><span class="p">.</span><span class="nf">new</span> <span class="c1">#=&gt; an exception is raised: missing keyword: name (ArgumentError)</span>
</code></pre>
</div>

<p>Close enough!</p>

<p>If your app is stuck on Ruby 2.0.0 or you’re making a library which supports
Ruby 2.0.0, maybe you’ll find this useful. Let me know if you do.</p>

<p>Here’s the entire source for the gem:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RequiredArg</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">nil?</span> <span class="p">?</span> <span class="s2">"missing keyword"</span> <span class="p">:</span> <span class="s2">"missing keyword: </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">raise</span> <span class="no">ArgumentError</span><span class="p">,</span> <span class="n">msg</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Pretty simple, and kind of fun. It’s just a little cherry bomb class. The moment
you instantiate it, it blows up. Make it the default value for a keyword
argument, and the moment you forget a keyword argument, the default will be used
and the expression will be evaluated for the first time. It’s cool that the
default values are lazily evaluated because it allows for things like this.</p>

<p>Check out the gem: <a href="https://github.com/maxjacobson/required_arg">https://github.com/maxjacobson/required_arg</a></p>

  </div>

  <div class="post-footer">
    <p>
      Feel free to get in touch via <a href='http://twitter.com/maxjacobson'>@maxjacobson</a> or <a href='mailto:max@hardscrabble.net'>max@hardscrabble.net</a>
    </p>
  </div>

</div>


<footer>
  <div>
    Powered by <a href="http://jekyllrb.com/">Jekyll</a>
    and hosted on <a href="https://pages.github.com/">GitHub Pages</a>.
    The source is <a href="https://github.com/hardscrabble/hardscrabble.github.io">available to browse, for nerds</a>.
    The feed can be found at <a href="/feed.xml">feed.xml</a>
  </div>
</footer>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<script src='/js/vendor/lunr.min.js'></script>
<script src='/js/app.js'></script>


<script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100815498); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100815498ns.gif" /></p></noscript>
</body>
</html>

